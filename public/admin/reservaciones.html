<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reservaciones | Luxury Condo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/reservaciones.css">
  <link rel="stylesheet" href="css/admin.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>

  <aside class="sidebar">
    <h2>Luxury Condo</h2>
    <nav>
      <a href="admin.html" class="active">Dashboard</a>
      <a href="reservaciones.html">Reservaciones</a>
      <a href="avisos.html">Avisos</a>
      <a href="clientes.html">Clientes</a>
      <a href="reportes.html">Reportes</a>

      <a href="index.html" class="logout">Cerrar sesión</a>
    </nav>
  </aside>

  <main class="main">

    <header class="header">
      <h1>Reservaciones</h1>
    </header>

    <section class="form-card">
      <h2>Filtros</h2>

      <div class="filters">
        <div class="form-group">
          <label>Estado</label>
          <select>
            <option>Todos</option>
            <option>Pendiente</option>
            <option>Confirmada</option>
            <option>Cancelada</option>
          </select>
        </div>

        <div class="form-group">
          <label>Fecha entrada</label>
          <input type="date">
        </div>

        <div class="form-group">
          <label>Fecha salida</label>
          <input type="date">
        </div>

        <button class="btn btn-primary">Buscar</button>
      </div>
    </section>

    <section class="table-section">
      <h2>Listado de reservaciones</h2>

      <table>
        <thead>
          <tr>
            <th>Cliente</th>
            <th>Habitación</th>
            <th>Entrada</th>
            <th>Salida</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>

        <tbody id="reservationTableBody">
          <tr>
            <td colspan="6">No hay reservaciones registradas.</td>
          </tr>
        </tbody>
      </table>
    </section>

  </main>

  <script>
    const STORAGE_KEY = "luxuryReservations";
    const tableBody = document.getElementById("reservationTableBody");

    const readReservations = () => {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return [];
      try {
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch (error) {
        return [];
      }
    };

    const getStatusClass = (status) => {
      if (!status) return "pending";
      const normalized = status.toLowerCase();
      if (normalized.includes("confirm")) return "active";
      return "pending";
    };

    const formatDate = (value) => (value ? value : "—");

    const renderTable = (reservations) => {
      if (!tableBody) return;
      tableBody.innerHTML = "";

      if (!reservations.length) {
        tableBody.innerHTML = "<tr><td colspan=\"6\">No hay reservaciones registradas.</td></tr>";
        return;
      }

      reservations.forEach((reservation) => {
        const row = document.createElement("tr");
        const guestName = reservation?.guest?.name || "—";
        const roomName = reservation?.room?.name
          || (reservation?.stayType === "other" ? "Otro" : "—");
        const status = reservation?.status || "Pendiente";
        const statusClass = getStatusClass(status);

        row.innerHTML = `
          <td>${guestName}</td>
          <td>${roomName}</td>
          <td>${formatDate(reservation.checkin)}</td>
          <td>${formatDate(reservation.checkout)}</td>
          <td class="status ${statusClass}">${status}</td>
          <td>
            <button class="btn btn-danger btn-small" data-action="delete" data-id="${reservation.id}">Eliminar</button>
          </td>
        `;
        tableBody.appendChild(row);
      });
    };

    tableBody.addEventListener("click", (event) => {
      const button = event.target.closest("[data-action]");
      if (!button) return;

      if (button.dataset.action === "delete") {
        const id = button.dataset.id;
        const nextReservations = readReservations().filter(item => String(item.id) !== String(id));
        localStorage.setItem(STORAGE_KEY, JSON.stringify(nextReservations));
        renderTable(nextReservations);
      }
    });

    renderTable(readReservations());
  </script>
</body>
</html>
